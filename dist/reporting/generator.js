/**
 * Report generation from audit findings
 * Uses Handlebars template for markdown output
 */
import { promises as fs } from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
import Handlebars from 'handlebars';
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
/**
 * Generate audit report from findings
 */
export async function generateReport(data, outputPath) {
    // Load template
    const templatePath = path.resolve(__dirname, '../../templates/report.md.hbs');
    let templateContent;
    try {
        templateContent = await fs.readFile(templatePath, 'utf-8');
    }
    catch {
        // Fallback to built-in template if file doesn't exist
        templateContent = getFallbackTemplate();
    }
    // Compile and render template
    const template = Handlebars.compile(templateContent);
    const markdown = template({
        ...data,
        grade: getGrade(data.score),
        timestamp: data.completedAt.toISOString(),
        toolName: path.basename(data.toolPath)
    });
    // Ensure output directory exists
    const outputDir = path.dirname(outputPath);
    await fs.mkdir(outputDir, { recursive: true });
    // Write report
    await fs.writeFile(outputPath, markdown, 'utf-8');
    return outputPath;
}
/**
 * Get letter grade from numeric score
 */
function getGrade(score) {
    if (score >= 9)
        return 'A+';
    if (score >= 8)
        return 'A';
    if (score >= 7)
        return 'B';
    if (score >= 6)
        return 'C';
    if (score >= 4)
        return 'D';
    return 'F';
}
/**
 * Fallback template if external file not found
 */
function getFallbackTemplate() {
    return `# USER EXPERIENCE AUDIT REPORT

**Tool**: {{toolName}}
**Path**: {{toolPath}}
**Date**: {{timestamp}}
**Score**: {{score}}/10 ({{grade}})

---

## Executive Summary

This tool received a score of **{{score}}/10 ({{grade}})** based on comprehensive UX audit across 5 phases.

### Overall Grade: {{grade}}

{{#if redFlags}}
- **Red Flags Found**: {{redFlags.length}}
{{else}}
- **Red Flags Found**: 0
{{/if}}

---

## Phase Findings

### Phase 1: First Impressions
{{#if findings.firstImpressions}}
- README Score: {{findings.firstImpressions.readmeScore}}/10
- Installation Instructions: {{#if findings.firstImpressions.hasInstallInstructions}}‚úÖ{{else}}‚ùå{{/if}}
- Code Examples: {{#if findings.firstImpressions.hasExamples}}‚úÖ{{else}}‚ùå{{/if}}
{{else}}
*Phase not completed*
{{/if}}

### Phase 2: Installation Test
{{#if findings.installation}}
- Installation: {{#if findings.installation.success}}‚úÖ Success{{else}}‚ùå Failed{{/if}}
- Duration: {{findings.installation.duration}}ms
- Method: {{findings.installation.method}}
{{else}}
*Phase not completed*
{{/if}}

### Phase 3: Functionality Check
{{#if findings.functionality}}
- Commands Tested: {{findings.functionality.commandsTested.length}}
- Successful: {{findings.functionality.successfulExecutions}}
- Failed: {{findings.functionality.failedExecutions}}
{{else}}
*Phase not completed*
{{/if}}

### Phase 4: Data Verification
{{#if findings.verification}}
- Claims Verified: {{findings.verification.verifiedClaims.length}}
- Accuracy Issues: {{findings.verification.accuracyIssues.length}}
{{else}}
*Phase not completed*
{{/if}}

---

## Red Flags

{{#if redFlags}}
{{#each redFlags}}
### {{severity}}: {{title}}

**Category**: {{category}}

{{description}}

**Evidence**:
{{#each evidence}}
- {{this}}
{{/each}}

**Fix**: {{fix}}

{{#if location}}
**Location**: \`{{location}}\`
{{/if}}

---
{{/each}}
{{else}}
No red flags found! üéâ
{{/if}}

---

## Recommendations

1. Address critical red flags first
2. Improve README with clear installation instructions
3. Add code examples for common use cases
4. Test functionality with real user scenarios
5. Verify all claims against live sources

---

*Generated by [user-experience](https://github.com/user-experience/cli)*
`;
}
//# sourceMappingURL=generator.js.map